@import 'mixins/font-face';
@import 'mixins/grid';

@tailwind base;
@tailwind components;
@tailwind utilities;

// Mozilla Sans
@include font-face('Mozilla Sans', 'MozillaSansBETA-ExtraLight', 200, normal);
@include font-face('Mozilla Sans', 'MozillaSansBETA-Light', 300, normal);
@include font-face('Mozilla Sans', 'MozillaSansBETA-Regular', 400, normal);
@include font-face('Mozilla Sans', 'MozillaSansBETA-SemiBold', 600, normal);
@include font-face('Mozilla Sans', 'MozillaSansBETA-Bold', 700, normal);
// Mozilla Semi Slab
@include font-face('Mozilla Semi Slab', 'MozillaSemiSlabBETA-ExtraLight', 200, normal);
@include font-face('Mozilla Semi Slab', 'MozillaSemiSlabBETA-Light', 300, normal);
@include font-face('Mozilla Semi Slab', 'MozillaSemiSlabBETA-Regular', 400, normal);
@include font-face('Mozilla Semi Slab', 'MozillaSemiSlabBETA-SemiBold', 600, normal);
@include font-face('Mozilla Semi Slab', 'MozillaSemiSlabBETA-Bold', 700, normal);
// Mozilla Semi Slab Condensed
@include font-face('Mozilla Semi Slab Condensed', 'MozillaSemiSlabCndBETA-ExtraLight', 200, normal);
@include font-face('Mozilla Semi Slab Condensed', 'MozillaSemiSlabCndBETA-Light', 300, normal);
@include font-face('Mozilla Semi Slab Condensed', 'MozillaSemiSlabCndBETA-Regular', 400, normal);
@include font-face('Mozilla Semi Slab Condensed', 'MozillaSemiSlabCndBETA-SemiBold', 600, normal);
@include font-face('Mozilla Semi Slab Condensed', 'MozillaSemiSlabCndBETA-Bold', 700, normal);
// Mozilla Semi Slab Extended
@include font-face('Mozilla Semi Slab Extended', 'MozillaSemiSlabExtBETA-ExtraLight', 200, normal);
@include font-face('Mozilla Semi Slab Extended', 'MozillaSemiSlabExtBETA-Light', 300, normal);
@include font-face('Mozilla Semi Slab Extended', 'MozillaSemiSlabExtBETA-Regular', 400, normal);
@include font-face('Mozilla Semi Slab Extended', 'MozillaSemiSlabExtBETA-SemiBold', 600, normal);
@include font-face('Mozilla Semi Slab Extended', 'MozillaSemiSlabExtBETA-Bold', 700, normal);

body {
  @apply bg-white text-black;
  @apply font-sans font-normal text-base antialiased;
}

:root {
  @apply [--100vw:min(100vw,1920px)];
  @apply [--grid-site-cols:6] md:[--grid-site-cols:24];
  @apply [--grid-site-margin:calc((24/400)*var(--100vw))] md:[--grid-site-margin:calc((32/1440)*var(--100vw))];
  @apply [--grid-site-gutter:calc((24/400)*var(--100vw))] md:[--grid-site-gutter:calc((40/1440)*var(--100vw))];
}

@layer components {
  .type-slab-2xl {
    @apply text-8xl font-slab-condensed font-semibold leading-none;
  }

  .type-slab-xl {
    @apply text-6xl font-slab-condensed font-semibold leading-none;
  }

  .type-slab-lg {
    @apply text-2xl font-slab-condensed font-semibold leading-tight;
  }

  .type-sans-xl {
    @apply text-6xl font-sans font-light leading-tighter tracking-tight;
  }

  .type-sans-lg {
    @apply text-4xl font-sans font-light leading-tighter tracking-tight;
  }

  .type-sans-md {
    @apply text-2xl font-sans font-light leading-tighter tracking-tight;
  }

  .type-sans-sm {
    @apply text-xl font-sans font-light leading-tighter tracking-tight;
  }

  .type-code {
    @apply bg-black text-white py-0.5 px-1 decoration-clone text-sm;
  }

  .type-caption {
    @apply uppercase opacity-50 text-sm leading-tight;
  }
}

@layer utilities {
  .centered-page {
    @apply max-w-page w-full mx-auto;
  }

  // Grid utilities
  .grid {
    --column-count: initial;
    --column-start: initial;
    --column-end: initial;
  }
  @for $i from 1 through 24 {
    .grid-cols-#{$i} {
      @include grid-template-columns($i);
    }
    .col-span-#{$i} {
      @include grid-column-span($i);
    }
    .col-start-#{$i} {
      @include grid-column-start($i);
    }
    .col-end-#{$i} {
      @include grid-column-end($i);
    }
  }
  .grid-cols-site {
    @include grid-template-columns(var(--grid-site-cols));
  }
  .col-span-1\/2 {
    @include grid-column-span(calc(var(--column-count) / 2));
  }
  .col-span-1\/3 {
    @include grid-column-span(calc(var(--column-count) / 3));
  }
  .col-span-2\/3 {
    @include grid-column-span(calc(var(--column-count) * 2 / 3));
  }
  .col-span-1\/6 {
    @include grid-column-span(calc(var(--column-count) / 6));
  }
  .col-span-2\/6 {
    @include grid-column-span(calc(var(--column-count) * 2 / 6));
  }
  .col-span-3\/6 {
    @include grid-column-span(calc(var(--column-count) * 3 / 6));
  }
  .col-span-4\/6 {
    @include grid-column-span(calc(var(--column-count) * 4 / 6));
  }
  .col-span-5\/6 {
    @include grid-column-span(calc(var(--column-count) * 5 / 6));
  }
  .col-span-full {
    @include grid-column-span(var(--column-count));
  }
  .col-span-screen {
    @apply col-span-full -mx-grid-site-margin;
  }
  .col-start-center {
    @include grid-column-start(calc((var(--column-count) - var(--column-span)) / 2 + 1));
  }
  .grid-site {
    @apply grid-cols-site gap-x-grid-site-gutter px-grid-site-margin;
  }

  .prose {
    // Gap between blocks
    > * + * {
      @apply mt-6;
    }

    // Headings
    > h2 {
      @apply font-semibold uppercase leading-tight indent-6;
    }
    > h3 {
      @apply uppercase leading-tight indent-6;
    }
    > h4 {
      @apply uppercase leading-tight opacity-50 indent-6;
    }
    > h5 {
      @apply font-semibold leading-tight;
    }
    > h6 {
      @apply leading-tight opacity-50;
    }

    // Paragraphs
    > p {
      &:empty {
        @apply hidden;
      }
    }

    // Lists
    > ul,
    > ol {
      li {
        @apply leading-normal;
      }

      li + li,
      li > ul,
      li > ol {
        @apply mt-2;
      }
    }
    > ul li {
      @apply relative pl-5;

      &::before {
        content: '';
        @apply absolute left-0 top-[7px] flex size-2.5 bg-green;
      }
    }
    > ol li {
      @apply relative pl-5;

      &::before {
        content: counter(list-item);
        @apply absolute left-0 top-0 font-semibold text-green;
      }
    }

    // Separators
    hr {
      @apply my-6 border-transparent overflow-visible;

      &::before {
        content: '';
        @apply block h-[0.5px] w-full opacity-50;
        background-image: linear-gradient(to right, black 33%, transparent 0%);
        background-position: bottom;
        background-size: 4px 1px;
        background-repeat: repeat-x;
      }
    }
  }

  .gutenberg {
    @apply grid grid-site centered-page;
    @apply prose;

    // Column-sizing
    > * {
      // Apply full-width size to all blocks, by default
      @apply col-span-full col-start-center;
    }
    > h1,
    > h2,
    > h3,
    > h4,
    > h5,
    > h6,
    > p,
    > pre,
    > ul,
    > ol,
    hr {
      @apply md:col-span-16 lg:col-span-10;
    }

    > h1,
    > h2,
    > h3,
    > h4,
    > h5,
    > h6,
    > p,
    > ul > li,
    > ol > li,
    > pre {
      // Inline images
      img {
        @apply inline-flex translate-y-[-5%];
        @apply h-[1em] w-auto !important;
      }

      // Inline code
      code {
        @apply type-code;
      }

      // Inline links
      a {
        @apply underline hover:text-green focus:text-green;
      }
    }

    // Paragraphs
    > p {
      &:first-child:is(.lede *) {
        @apply type-slab-lg mb-2 md:mb-6 md:col-span-18 lg:col-span-14;
      }
    }

    // Code block
    pre {
      code {
        @apply block bg-black px-4 py-3 leading-loose;
      }
    }

    // Alignment
    > figure,
    > [data-block] {
      &:not(.alignwide):not(.alignfull) {
        @apply md:col-span-16;
      }

      &.alignwide {
        @apply md:col-span-20;
      }

      &.alignfull:not(.wp-block-pullquote):not(.wp-block-table) {
        @apply md:col-span-screen;

        figcaption {
          @apply md:px-[--grid-site-margin];
        }
      }
    }

    // Figures and captions
    > figure {
      @apply flex flex-col gap-3;

      figcaption {
        @apply type-caption;
      }

      &.alignfull:not(.wp-block-pullquote):not(.wp-block-table) {
        figcaption {
          @apply md:px-[--grid-site-margin];
        }
      }
    }

    // Blockquotes
    figure.wp-block-pullquote,
    blockquote {
      @apply flex flex-col gap-3;

      &:not(.alignwide):not(.alignfull) {
        @apply md:col-span-full;
      }

      p {
        @apply type-slab-xl md:indent-[calc(0.2*var(--100vw))];
      }

      cite {
        @apply type-caption not-italic;
      }
    }

    // Tables
    figure.wp-block-table {
      table {
        thead {
          @apply border-t border-black text-left align-top;

          tr th {
            @apply py-3 uppercase text-sm font-normal;

            &:not(:last-child) {
              @apply pr-3;
            }
          }
        }

        tbody {
          tr {
            @apply border-t border-black;
          }

          tr td {
            @apply py-3;

            &:not(:last-child) {
              @apply pr-3;
            }
          }
        }
      }
    }

    // Images
    figure.wp-block-image,
    figure.wp-block-video,
    figure.wp-block-embed {
      &:not(.alignwide):not(.alignfull) {
        @apply md:col-span-12;
      }

      img,
      video,
      .wp-block-embed__wrapper iframe {
        @apply w-full h-auto;
      }
    }

    // Embeds
    figure.wp-block-embed {
      .wp-block-embed__wrapper {
        @apply flex w-full justify-center;
      }

      &.wp-has-aspect-ratio {
        &.wp-embed-aspect-16-9 .wp-block-embed__wrapper iframe {
          @apply aspect-video;
        }

        &.wp-embed-aspect-4-3 .wp-block-embed__wrapper iframe {
          @apply aspect-[4/3];
        }
      }
    }

    // Buttons
    .wp-block-buttons {
      @apply flex flex-col gap-3 md:col-span-16 lg:col-span-10;
    }
    .wp-block-button {
      @apply flex justify-center w-full;
    }
    .wp-block-button__link {
      @apply w-full p-10 uppercase text-center bg-black text-white border border-black transition-colors hover:text-black focus:text-black hover:bg-green focus:bg-green hover:border-green focus:border-green;
    }
    .is-style-outline .wp-block-button__link {
      @apply bg-transparent text-black hover:text-green focus:text-green;
    }

    // Files
    .wp-block-file {
      @apply flex md:col-span-16 lg:col-span-10;

      a:not(.wp-block-file__button) {
        @apply flex items-center justify-between gap-10 w-full p-10 bg-green text-black uppercase font-semibold border-2 border-green transition-colors hover:border-black focus:border-black;

        &:has(+ a.wp-block-file__button) {
          @apply md:py-8;

          &::after {
            @apply block shrink-0 content-arrow size-10 md:size-14 transition-colors hover:translate-y-2 focus:translate-y-2;
          }
        }
      }

      a.wp-block-file__button {
        @apply hidden;
      }
    }
  }
}
